<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake Game Tutorial by Devahoy</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet" />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Itim', cursive;
        font-weight: 400;
        font-style: normal;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #333;

        color: #fff;
        background: linear-gradient(to right top, #051937, #004d7a, #008793, #00bf72, #a8eb12);
      }

      .game-container {
        text-align: center;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .score {
        font-size: 24px;
        margin-bottom: 10px;
        color: #fff;
      }

      #gameCanvas {
        border: 3px solid white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        background: #2a2a2a;
      }

      .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        display: none;
      }

      .controls {
        margin-top: 16px;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        margin-top: 15px;
        transition: background 0.3s;
      }

      button:hover {
        background: #5a6fd8;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="score">Score: <span id="score">0</span></div>
      <canvas id="gameCanvas" width="400" height="400"></canvas>
      <div class="controls">
        <p>ใช้ปุ่มลูกศรเพื่อเล่น</p>
        <button onclick="startGame()">Restart Game</button>
      </div>
      <div class="game-over" id="gameOver">
        Game Over!<br />
        <button onclick="startGame()">Play Again</button>
      </div>
    </div>
    <script>
      const canvas = document.getElementById('gameCanvas')
      const ctx = canvas.getContext('2d')
      const scoreElement = document.getElementById('score')
      const gameOverElement = document.getElementById('gameOver')

      const gridSize = 20
      const tileCount = canvas.width / gridSize

      let snake = [{ x: 10, y: 10 }]

      let food = { x: 15, y: 15 }

      let dx = 0
      let dy = 0

      let score = 0
      let isGameRunning = true

      let lastUpdateTime = 0
      const targetFPS = 10
      const frameInterval = 1000 / targetFPS // 100ms

      function drawSnake() {
        ctx.fillStyle = '#0f0'

        for (let body of snake) {
          ctx.fillRect(body.x * gridSize, body.y * gridSize, gridSize - 2, gridSize - 2)
        }
      }

      function drawFood() {
        ctx.fillStyle = '#f00'

        ctx.beginPath()
        ctx.arc(
          food.x * gridSize + gridSize / 2,
          food.y * gridSize + gridSize / 2,
          gridSize / 2, // radius
          0,
          Math.PI * 2
        )

        ctx.fill()
      }

      function clearCanvas() {
        ctx.fillStyle = 'f00'
        ctx.clearRect(0, 0, canvas.width, canvas.height)
      }

      function moveSnake() {
        // x=10, y=10
        const head = {
          x: snake[0].x + dx,
          y: snake[0].y + dy
        }

        snake.unshift(head)

        if (!checkFoodCollision()) {
          snake.pop()
        }
      }

      function checkFoodCollision() {
        const head = snake[0]

        // งูกินอาหาร
        if (head.x === food.x && head.y === food.y) {
          score += 10

          updateScore()
          generateFood()

          return true
        }

        return false
      }

      function generateFood() {
        food = {
          x: Math.floor(Math.random() * tileCount),
          y: Math.floor(Math.random() * tileCount)
        }

        for (let body of snake) {
          if (body.x == food.x && body.y === food.y) {
            generateFood()
            return
          }
        }
      }

      function checkCollision() {
        const head = snake[0]

        // ชนกำแพง
        if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
          return true
        }

        // ชนตัวเอง
        for (let body of snake.slice(1)) {
          if (head.x === body.x && head.y === body.y) {
            return true
          }
        }

        return false
      }

      function gameOver() {
        alert('Game Over!')

        // reset game
        snake = [{ x: 10, y: 10 }]
        dx = 0
        dy = 0
        food = {
          x: Math.floor(Math.random() * tileCount),
          y: Math.floor(Math.random() * tileCount)
        }
      }

      function drawGame() {
        clearCanvas()

        if (checkCollision()) {
          gameOver()
          return
        }

        drawSnake()
        drawFood()
      }

      function gameLoop(timestamp) {
        if (!isGameRunning) return

        const deltaTime = timestamp - lastUpdateTime
        if (deltaTime >= frameInterval) {
          // ถ้างูยังไม่ตาย
          if (!checkCollision()) {
            moveSnake()
            drawGame()
          } else {
            gameOver()
          }

          lastUpdateTime = timestamp
        }

        requestAnimationFrame(gameLoop)
      }

      function updateScore() {
        scoreElement.textContent = score
      }

      function gameOver() {
        isGameRunning = false
        gameOverElement.style.display = 'block'

        // reset game state
        resetGame()
      }

      function resetGame() {
        snake = [{ x: 10, y: 10 }]
        dx = 0
        dy = 0
        score = 0
      }

      function initializeGameState() {
        resetGame()
        generateFood()

        gameOverElement.style.display = 'none'
        isGameRunning = true
        updateScore()
      }

      function startGame() {
        initializeGameState()
        gameLoop()
      }

      startGame()

      document.addEventListener('keydown', (event) => {
        event.preventDefault()
        if (event.key === 'ArrowUp') {
          if (dy !== 1) {
            dy = -1
            dx = 0
          }
        } else if (event.key === 'ArrowDown') {
          if (dy !== -1) {
            dy = 1
            dx = 0
          }
        } else if (event.key === 'ArrowLeft') {
          if (dx !== 1) {
            dx = -1
            dy = 0
          }
        } else if (event.key === 'ArrowRight') {
          if (dx !== -1) {
            dx = 1
            dy = 0
          }
        }
      })
    </script>
  </body>
</html>
